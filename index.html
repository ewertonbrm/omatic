<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Switch O' Matic - Pager</title>
    <!-- Adiciona link para o manifest para tornar o app instalável -->
    <link rel="manifest" href="manifest.json">
    <!-- Tailwind CSS CDN --><script src="https://cdn.tailwindcss.com"></script>
    <!-- JSZip CDN for ZIP file generation --><script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
    <style>
        /* Importa uma fonte que simula caracteres de tela digital/mono */
        @import url('https://fonts.googleapis.com/css2?family=VT323&display=swap');
        /* Outras opções de fontes: 'Press Start 2P', 'Roboto Mono' */
        
        /* Definindo as cores do tema */
        :root {
            --pager-green: #90EE90; /* Verde limão clássico de pager */
            --pager-black: #000000;
        }

        body {
            font-family: 'VT323', monospace; /* Fonte monoespaçada para simular o pager */
            background-color: var(--pager-green); /* Fundo verde limão */
            color: var(--pager-black); /* Texto preto */
            display: flex;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            padding: 1rem;
            text-shadow: 1px 1px 0px rgba(0,0,0,0.1); /* Sombra para dar profundidade ao texto */
        }

        /* Container principal: Sem sombra, como um pager simples */
        #app {
            background-color: var(--pager-green); /* Fundo verde limão */
            border: 5px solid var(--pager-black); /* Borda preta grossa */
            border-radius: 8px; /* Cantos levemente arredondados */
            box-shadow: 8px 8px 0px -2px rgba(0,0,0,0.5); /* Sombra dura para efeito 3D antigo */
        }

        /* Estilo para inputs e textarea */
        input, textarea {
            background-color: var(--pager-green); /* Fundo verde limão */
            color: var(--pager-black); /* Texto preto */
            border: 2px solid var(--pager-black); /* Borda preta */
            border-radius: 4px;
            padding: 0.75rem 1rem; /* Padding adequado */
            font-size: 1.125rem; /* Tamanho de fonte maior para leitura no pager */
            line-height: 1.5;
        }

        /* Foco dos inputs: Borda preta sólida, sem ring glow */
        input:focus, textarea:focus {
            outline: none;
            border-color: var(--pager-black);
            box-shadow: none; /* Sem sombra no foco */
        }

        /* Estilização da caixa de mensagem de status */
        #messageBox {
            opacity: 0;
            transition: opacity 0.3s ease-in-out, transform 0.3s ease-in-out;
            transform: translateY(-5px);
            background-color: var(--pager-black); /* Fundo preto para destaque */
            color: var(--pager-green); /* Texto verde limão */
            border: 2px solid var(--pager-green);
            font-weight: bold;
        }
        #messageBox.opacity-100 {
            transform: translateY(0);
        }
        /* Cores de feedback invertidas para o tema Pager */
        #messageBox.error-style { 
            background-color: #ff0000; /* Vermelho forte para erro */
            color: var(--pager-green); 
            border: 2px solid var(--pager-green);
        }
        #messageBox.success-style { 
            background-color: #008000; /* Verde forte para sucesso */
            color: var(--pager-green); 
            border: 2px solid var(--pager-green);
        }

        /* Estilo para o Textarea de Código (mantém a fonte mono, mas alinhado ao tema) */
        #cheatCode {
            font-family: 'VT323', monospace;
            background-color: var(--pager-green);
            color: var(--pager-black);
        }

        /* Botão "Cha-Ching!" */
        #submitButton {
            background-color: var(--pager-black); /* Fundo preto */
            color: var(--pager-green); /* Texto verde limão */
            font-size: 1.5rem; /* Botão maior e mais chamativo */
            border: 2px solid var(--pager-green); /* Borda verde limão */
            border-radius: 4px; /* Cantos arredondados */
            box-shadow: 4px 4px 0px -1px rgba(0,0,0,0.5); /* Sombra dura */
        }
        #submitButton:hover {
            background-color: #333333; /* Levemente mais claro no hover */
            color: #adff2f; /* Verde mais vibrante no hover */
            transform: none; /* Sem scale no hover para manter o estilo pager */
        }
        #submitButton:active {
            box-shadow: 2px 2px 0px -1px rgba(0,0,0,0.5); /* Sombra menor no active */
            transform: translateY(2px) translateX(2px); /* Efeito de clique */
        }
        #submitButton:disabled {
            background-color: #333333;
            color: #666666;
            cursor: not-allowed;
            box-shadow: none;
        }

        /* Classes Tailwind personalizadas (se necessário, estender no config) */
        .text-pager-green { color: var(--pager-green); }
        .bg-pager-green { background-color: var(--pager-green); }
        .border-pager-green { border-color: var(--pager-green); }

        .text-pager-black { color: var(--pager-black); }
        .bg-pager-black { background-color: var(--pager-black); }
        .border-pager-black { border-color: var(--pager-black); }

    </style>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'pager-green': '#90EE90',
                        'pager-black': '#000000',
                    }
                }
            }
        }

        // ------------------ REGISTRO DO SERVICE WORKER ------------------
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('service-worker.js')
                    .then(registration => {
                        console.log('SW registrado com sucesso. Escopo:', registration.scope);
                    })
                    .catch(error => {
                        console.log('Falha no registro do SW:', error);
                    });
            });
        }
        // ----------------------------------------------------------------
    </script>
</head>
<body class="selection:bg-pager-black selection:text-pager-green">

    <!-- Main Container: Agora com estilo de Pager --><div id="app" class="w-full max-w-md p-6 md:p-8">
        
        <!-- Header (Simples e direto, sem logo) --><header class="text-center mb-8">
            <h1 class="text-5xl font-bold uppercase mb-2 leading-none">
                Switch O' Matic
            </h1>
            <p class="text-xl font-medium">-- Pager Edition --</p>
        </header>

        <!-- Form Area --><form id="cheatForm" onsubmit="handleChaChing(event)">

            <!-- Status/Error Message Area --><div id="messageBox" class="p-3 mb-6 hidden rounded-lg text-lg text-center transition-all duration-300"></div>

            <!-- Game ID Input --><div class="mb-5">
                <label for="gameId" class="block text-base font-bold uppercase mb-1">ID DO JOGO (16 DIGITOS HEX)</label>
                <input type="text" id="gameId" name="gameId" required minlength="16" maxlength="16" pattern="[0-9A-Fa-f]{16}" placeholder="0100ABCD00001000" class="w-full" oninput="validateId(this)">
                <p id="gameIdError" class="text-base font-bold mt-1 hidden text-red-500">ID DEVE TER 16 DIGITOS HEXADECIMAIS!</p>
            </div>

            <!-- Update ID Input --><div class="mb-5">
                <label for="updateId" class="block text-base font-bold uppercase mb-1">ID DE UPDATE (16 DIGITOS HEX)</label>
                <input type="text" id="updateId" name="updateId" required minlength="16" maxlength="16" pattern="[0-9A-Fa-f]{16}" placeholder="F719A700588E2BCF" class="w-full" oninput="validateId(this)">
                <p id="updateIdError" class="text-base font-bold mt-1 hidden text-red-500">ID DEVE TER 16 DIGITOS HEXADECIMAIS!</p>
            </div>

            <!-- Cheat Name Input --><div class="mb-5">
                <label for="cheatName" class="block text-base font-bold uppercase mb-1">NOME DO CHEAT</label>
                <input type="text" id="cheatName" name="cheatName" required placeholder="VIDA INFINITA" class="w-full">
            </div>

            <!-- Cheat Code Textarea --><div class="mb-8">
                <label for="cheatCode" class="block text-base font-bold uppercase mb-1">CODIGO DO CHEAT</label>
                <textarea id="cheatCode" name="cheatCode" required rows="6" placeholder="INSIRA SEU CODIGO AQUI. EX: 580F0000 05B00000..." class="w-full resize-none"></textarea>
            </div>

            <!-- Submit Button (Preto com texto verde) --><button type="submit" id="submitButton" class="w-full font-bold py-4 transition duration-150 flex items-center justify-center">
                <span id="buttonText">CHA-CHING!</span>
                <div id="spinner" class="hidden animate-spin rounded-full h-5 w-5 border-b-2 border-pager-green ml-2"></div>
            </button>
        </form>

    </div>

    <script>
        // Variáveis globais para referências de UI
        const messageBox = document.getElementById('messageBox');
        const submitButton = document.getElementById('submitButton');
        const buttonText = document.getElementById('buttonText');
        const spinner = document.getElementById('spinner');

        /**
         * Função de validação em tempo real para os campos de 16 dígitos.
         * @param {HTMLInputElement} input - O elemento de input a ser validado.
         */
        function validateId(input) {
            const errorElement = document.getElementById(`${input.id}Error`);
            const hexRegex = /^[0-9A-Fa-f]{0,16}$/;
            const value = input.value.toUpperCase();

            // Filtrar caracteres não hexadecimais (mantendo o limite de 16)
            let filteredValue = '';
            for (let i = 0; i < value.length; i++) {
                if (hexRegex.test(value.substring(0, i + 1))) {
                    filteredValue += value[i];
                }
            }
            input.value = filteredValue.substring(0, 16);

            // Verificar o comprimento final
            if (input.value.length !== 16) {
                errorElement.classList.remove('hidden');
                // input.classList.remove('border-green-500'); // Remover validação visual de sucesso
                input.classList.add('border-red-500'); // Usar vermelho para erro no input
                return false;
            } else {
                errorElement.classList.add('hidden');
                input.classList.remove('border-red-500');
                input.classList.add('border-pager-black'); // Borda preta normal quando válido
                return true;
            }
        }

        /**
         * Exibe uma mensagem de feedback na caixa de mensagens.
         * @param {string} message - O texto da mensagem.
         * @param {string} type - O tipo de mensagem ('success' ou 'error').
         */
        function showMessage(message, type) {
            messageBox.textContent = message;
            messageBox.classList.remove('hidden', 'error-style', 'success-style', 'opacity-0');
            
            if (type === 'error') {
                messageBox.classList.add('error-style');
                messageBox.classList.remove('success-style');
            } else {
                messageBox.classList.add('success-style');
                messageBox.classList.remove('error-style');
            }
            messageBox.classList.add('opacity-100');

            // Ocultar a mensagem após 5 segundos
            setTimeout(() => {
                messageBox.classList.remove('opacity-100');
                setTimeout(() => messageBox.classList.add('hidden'), 300);
            }, 5000);
        }

        /**
         * Controla o estado de carregamento do botão.
         * @param {boolean} isLoading - Se deve mostrar o estado de carregamento.
         */
        function setLoading(isLoading) {
            submitButton.disabled = isLoading;
            if (isLoading) {
                buttonText.textContent = 'GERANDO ZIP...';
                spinner.classList.remove('hidden');
                submitButton.classList.add('bg-gray-700', 'cursor-not-allowed', 'shadow-none');
                submitButton.classList.remove('bg-pager-black', 'shadow-lg', 'hover:bg-black');
            } else {
                buttonText.textContent = 'CHA-CHING!';
                spinner.classList.add('hidden');
                submitButton.classList.remove('bg-gray-700', 'cursor-not-allowed', 'shadow-none');
                submitButton.classList.add('bg-pager-black', 'shadow-lg', 'hover:bg-black');
            }
        }

        /**
         * Lida com o envio do formulário, cria a estrutura ZIP e inicia o download.
         * @param {Event} event - O evento de envio do formulário.
         */
        async function handleChaChing(event) {
            event.preventDefault();
            setLoading(true);
            messageBox.classList.add('hidden'); 

            const gameId = document.getElementById('gameId').value.toUpperCase();
            const updateId = document.getElementById('updateId').value.toUpperCase();
            const cheatName = document.getElementById('cheatName').value.toUpperCase(); // Tudo maiúsculo para o estilo pager
            const cheatCode = document.getElementById('cheatCode').value.toUpperCase(); // Tudo maiúsculo

            // 1. Validação final
            const isGameIdValid = validateId(document.getElementById('gameId'));
            const isUpdateIdValid = validateId(document.getElementById('updateId'));
            
            if (!isGameIdValid || !isUpdateIdValid || !cheatName || !cheatCode) {
                showMessage('ERRO! PREENCHA TODOS OS CAMPOS E CORRIJA OS IDS.', 'error');
                setLoading(false);
                return;
            }

            try {
                // 2. Inicializar JSZip
                const zip = new JSZip();

                // 3. Definir o conteúdo do arquivo TXT
                const fileContent = `[${cheatName}]\n${cheatCode.trim()}`;

                // 4. Criar a estrutura de pastas
                const zipPath = `${gameId}/${cheatName}/cheats/${updateId}.txt`;
                
                // Adicionar o arquivo ao ZIP usando o caminho completo (JSZip cria as pastas automaticamente)
                zip.file(zipPath, fileContent);

                // 5. Gerar o arquivo ZIP como Blob
                const content = await zip.generateAsync({
                    type: "blob",
                    compression: "DEFLATE", 
                    compressionOptions: { level: 9 }
                });

                // 6. Iniciar o download
                const downloadFileName = `${gameId}.zip`;
                
                const a = document.createElement('a');
                const url = URL.createObjectURL(content);
                a.href = url;
                a.download = downloadFileName;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                
                URL.revokeObjectURL(url);

                showMessage(`SUCESSO! ARQUIVO "${downloadFileName}" GERADO E BAIXADO.`, 'success');
                
            } catch (error) {
                console.error("Erro ao gerar ou baixar o arquivo ZIP:", error);
                showMessage('ERRO! OCORREU UM ERRO INESPERADO AO GERAR O ARQUIVO. TENTE NOVAMENTE.', 'error');
            } finally {
                setLoading(false);
            }
        }

        // Aplicar a validação aos campos de ID ao carregar a página
        window.onload = function() {
            document.getElementById('gameId').addEventListener('input', function() { validateId(this); });
            document.getElementById('updateId').addEventListener('input', function() { validateId(this); });
            messageBox.classList.add('hidden');
        };
    </script>
</body>
</html>
