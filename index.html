<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Switch O' Matic</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- JSZip CDN for ZIP file generation -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
    <style>
        /* Importa a fonte Poppins */
        @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700;800&display=swap');
        
        /* Estilos globais e fundo vermelho E70009 */
        body {
            font-family: 'Poppins', sans-serif;
            background-color: #E70009; /* Fundo vermelho solicitado */
            color: #ffffff; /* Texto claro no fundo vermelho */
            display: flex;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            padding: 1rem;
        }

        /* Define a cor principal para o foco e interatividade */
        .switch-red { color: #E70009; }
        .bg-switch-red { background-color: #E70009; }
        .border-switch-red { border-color: #E70009; }

        /* Estilo para o container principal (agora vermelho) */
        .main-card {
            /* Sombra clara para fazê-lo saltar do fundo */
            box-shadow: 0 10px 30px rgba(255, 255, 255, 0.4), 0 0 0 1px rgba(255, 255, 255, 0.2);
            transition: box-shadow 0.3s ease;
        }
        .main-card:hover {
            box-shadow: 0 15px 40px rgba(255, 255, 255, 0.6), 0 0 0 1px rgba(255, 255, 255, 0.3);
        }

        /* Estilo de foco para inputs - Borda vermelha forte */
        input:focus, textarea:focus {
            outline: none;
            border-color: #E70009 !important;
            box-shadow: 0 0 0 2px #E70009;
        }

        /* Estilização da caixa de mensagem de status */
        #messageBox {
            opacity: 0;
            transition: opacity 0.3s ease-in-out, transform 0.3s ease-in-out;
            transform: translateY(-5px);
            color: #1a1a1a; /* Texto escuro para legibilidade nas mensagens */
        }
        #messageBox.opacity-100 {
            transform: translateY(0);
        }
        /* Cores de feedback - Usam o vermelho principal e verde para contraste */
        #messageBox.error-style { 
            background-color: #ffffff; /* Branco para destacar o erro */
            color: #E70009; 
            border-left: 5px solid #E70009; 
        }
        #messageBox.success-style { 
            background-color: #ccffdd; /* Verde suave para sucesso */
            color: #057a55; 
            border-left: 5px solid #10b981; 
        }

        /* Estilo para o Textarea de Código (fonte monoespaçada e fundo claro) */
        #cheatCode {
            font-family: 'SFMono-Regular', Consolas, 'Liberation Mono', Menlo, Courier, monospace;
            padding: 12px;
            background-color: #f7f7f7;
            border: 1px solid #e0e0e0;
            transition: all 0.2s ease;
            color: #1a1a1a; /* Texto escuro para o código */
        }

        /* Animação de pulso para o ícone (mantida) */
        @keyframes pulse-icon {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }
        .animate-pulse-icon {
            animation: pulse-icon 2s infinite ease-in-out;
        }
    </style>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'switch-red': '#E70009',
                    }
                }
            }
        }
    </script>
</head>
<body class="selection:bg-white selection:text-switch-red">

    <!-- Main Container: Agora usa a cor Switch Red E70009 com sombra branca para destaque -->
    <div id="app" class="w-full max-w-md bg-switch-red main-card rounded-2xl p-6 md:p-8">
        
        <!-- Header (Limpo e elegante) -->
        <header class="text-center mb-8">
            <img src="icon-192x192.png" alt="Switch O' Matic Logo" class="w-20 h-20 mx-auto mb-4 animate-pulse-icon drop-shadow-md">
            <h1 class="text-4xl font-extrabold text-white tracking-tight">
                Switch O' Matic
            </h1>
            <p class="text-white mt-1 font-medium text-sm opacity-90">Gerador de Cheats Estruturado</p>
        </header>

        <!-- Form Area -->
        <form id="cheatForm" onsubmit="handleChaChing(event)">

            <!-- Status/Error Message Area -->
            <div id="messageBox" class="p-3 mb-6 hidden rounded-lg text-sm font-medium transition-all duration-300"></div>

            <!-- Game ID Input -->
            <div class="mb-5">
                <label for="gameId" class="block text-xs font-semibold uppercase text-white mb-1 opacity-80">ID do Jogo (16 dígitos Hex)</label>
                <input type="text" id="gameId" name="gameId" required minlength="16" maxlength="16" pattern="[0-9A-Fa-f]{16}" placeholder="Ex: 0100ABCD00001000" class="w-full px-4 py-3 border border-gray-300 rounded-xl transition duration-150 text-gray-800 focus:border-switch-red" oninput="validateId(this)">
                <p id="gameIdError" class="text-xs text-white mt-1 font-medium hidden" style="text-shadow: 0 0 5px rgba(0,0,0,0.5);">O ID deve ter exatamente 16 dígitos hexadecimais.</p>
            </div>

            <!-- Update ID Input -->
            <div class="mb-5">
                <label for="updateId" class="block text-xs font-semibold uppercase text-white mb-1 opacity-80">ID de Update (16 dígitos Hex)</label>
                <input type="text" id="updateId" name="updateId" required minlength="16" maxlength="16" pattern="[0-9A-Fa-f]{16}" placeholder="Ex: F719A700588E2BCF" class="w-full px-4 py-3 border border-gray-300 rounded-xl transition duration-150 text-gray-800 focus:border-switch-red" oninput="validateId(this)">
                <p id="updateIdError" class="text-xs text-white mt-1 font-medium hidden" style="text-shadow: 0 0 5px rgba(0,0,0,0.5);">O ID deve ter exatamente 16 dígitos hexadecimais.</p>
            </div>

            <!-- Cheat Name Input -->
            <div class="mb-5">
                <label for="cheatName" class="block text-xs font-semibold uppercase text-white mb-1 opacity-80">Nome do Cheat</label>
                <input type="text" id="cheatName" name="cheatName" required placeholder="Ex: Vida Infinita" class="w-full px-4 py-3 border border-gray-300 rounded-xl transition duration-150 text-gray-800 focus:border-switch-red">
            </div>

            <!-- Cheat Code Textarea -->
            <div class="mb-8">
                <label for="cheatCode" class="block text-xs font-semibold uppercase text-white mb-1 opacity-80">Código do Cheat</label>
                <!-- O input tem cor escura para legibilidade do código -->
                <textarea id="cheatCode" name="cheatCode" required rows="6" placeholder="Insira seu código do cheat aqui. Ex: 580F0000 05B00000..." class="w-full rounded-xl transition duration-150 resize-y"></textarea>
            </div>

            <!-- Submit Button (Usamos uma cor contrastante para o botão, como um cinza escuro) -->
            <button type="submit" id="submitButton" class="w-full bg-gray-900 text-white font-bold py-4 rounded-xl shadow-lg shadow-black/40 hover:bg-black transition duration-200 transform hover:scale-[1.01] flex items-center justify-center active:scale-[0.98] focus:ring-4 focus:ring-white/50 focus:outline-none">
                <span id="buttonText" class="text-lg">Cha-Ching!</span>
                <div id="spinner" class="hidden animate-spin rounded-full h-5 w-5 border-b-2 border-white ml-2"></div>
            </button>
        </form>

    </div>

    <script>
        // Variáveis globais para referências de UI
        const messageBox = document.getElementById('messageBox');
        const submitButton = document.getElementById('submitButton');
        const buttonText = document.getElementById('buttonText');
        const spinner = document.getElementById('spinner');

        /**
         * Função de validação em tempo real para os campos de 16 dígitos.
         * @param {HTMLInputElement} input - O elemento de input a ser validado.
         */
        function validateId(input) {
            const errorElement = document.getElementById(`${input.id}Error`);
            const hexRegex = /^[0-9A-Fa-f]{0,16}$/;
            const value = input.value.toUpperCase();

            // Filtrar caracteres não hexadecimais (mantendo o limite de 16)
            let filteredValue = '';
            for (let i = 0; i < value.length; i++) {
                if (hexRegex.test(value.substring(0, i + 1))) {
                    filteredValue += value[i];
                }
            }
            input.value = filteredValue.substring(0, 16);

            // Verificar o comprimento final
            if (input.value.length !== 16) {
                errorElement.classList.remove('hidden');
                input.classList.remove('border-green-500');
                input.classList.add('border-switch-red'); // Destacar o erro
                return false;
            } else {
                errorElement.classList.add('hidden');
                input.classList.remove('border-switch-red', 'border-gray-300');
                input.classList.add('border-green-500'); // Indicador de sucesso
                return true;
            }
        }

        /**
         * Exibe uma mensagem de feedback na caixa de mensagens.
         * @param {string} message - O texto da mensagem.
         * @param {string} type - O tipo de mensagem ('success' ou 'error').
         */
        function showMessage(message, type) {
            messageBox.textContent = message;
            messageBox.classList.remove('hidden', 'error-style', 'success-style', 'opacity-0');
            
            if (type === 'error') {
                messageBox.classList.add('error-style');
                messageBox.classList.remove('success-style');
            } else {
                messageBox.classList.add('success-style');
                messageBox.classList.remove('error-style');
            }
            messageBox.classList.add('opacity-100');

            // Ocultar a mensagem após 5 segundos
            setTimeout(() => {
                messageBox.classList.remove('opacity-100');
                setTimeout(() => messageBox.classList.add('hidden'), 300);
            }, 5000);
        }

        /**
         * Controla o estado de carregamento do botão.
         * @param {boolean} isLoading - Se deve mostrar o estado de carregamento.
         */
        function setLoading(isLoading) {
            submitButton.disabled = isLoading;
            if (isLoading) {
                buttonText.textContent = 'Gerando ZIP...';
                spinner.classList.remove('hidden');
                submitButton.classList.add('bg-gray-700', 'cursor-not-allowed', 'shadow-none');
                submitButton.classList.remove('bg-gray-900', 'shadow-black/40', 'hover:bg-black');
            } else {
                buttonText.textContent = 'Cha-Ching!';
                spinner.classList.add('hidden');
                submitButton.classList.remove('bg-gray-700', 'cursor-not-allowed', 'shadow-none');
                submitButton.classList.add('bg-gray-900', 'shadow-black/40', 'hover:bg-black');
            }
        }

        /**
         * Lida com o envio do formulário, cria a estrutura ZIP e inicia o download.
         * @param {Event} event - O evento de envio do formulário.
         */
        async function handleChaChing(event) {
            event.preventDefault();
            setLoading(true);
            messageBox.classList.add('hidden'); 

            const gameId = document.getElementById('gameId').value.toUpperCase();
            const updateId = document.getElementById('updateId').value.toUpperCase();
            const cheatName = document.getElementById('cheatName').value;
            const cheatCode = document.getElementById('cheatCode').value;

            // 1. Validação final
            const isGameIdValid = validateId(document.getElementById('gameId'));
            const isUpdateIdValid = validateId(document.getElementById('updateId'));
            
            if (!isGameIdValid || !isUpdateIdValid || !cheatName || !cheatCode) {
                showMessage('Por favor, preencha todos os campos e corrija os IDs de 16 dígitos.', 'error');
                setLoading(false);
                return;
            }

            try {
                // 2. Inicializar JSZip
                const zip = new JSZip();

                // 3. Definir o conteúdo do arquivo TXT
                const fileContent = `[${cheatName}]\n${cheatCode.trim()}`;

                // 4. Criar a estrutura de pastas
                const zipPath = `${gameId}/${cheatName}/cheats/${updateId}.txt`;
                
                // Adicionar o arquivo ao ZIP usando o caminho completo (JSZip cria as pastas automaticamente)
                zip.file(zipPath, fileContent);

                // 5. Gerar o arquivo ZIP como Blob
                const content = await zip.generateAsync({
                    type: "blob",
                    compression: "DEFLATE", 
                    compressionOptions: { level: 9 }
                });

                // 6. Iniciar o download
                const downloadFileName = `${gameId}.zip`;
                
                const a = document.createElement('a');
                const url = URL.createObjectURL(content);
                a.href = url;
                a.download = downloadFileName;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                
                URL.revokeObjectURL(url);

                showMessage(`Arquivo "${downloadFileName}" gerado e baixado com sucesso!`, 'success');
                
            } catch (error) {
                console.error("Erro ao gerar ou baixar o arquivo ZIP:", error);
                showMessage('Ocorreu um erro inesperado ao gerar o arquivo. Tente novamente.', 'error');
            } finally {
                setLoading(false);
            }
        }

        // Aplicar a validação aos campos de ID ao carregar a página
        window.onload = function() {
            document.getElementById('gameId').addEventListener('input', function() { validateId(this); });
            document.getElementById('updateId').addEventListener('input', function() { validateId(this); });
            messageBox.classList.add('hidden');
        };
    </script>
</body>
</html>

